const inputElement=document.querySelector(".calc__input"),outputOperationElement=document.querySelector(".calc__operation .value"),outputResultElement=document.querySelector(".calc__result .value"),operators=["+","-","*","/"],power="power(",sqrt="Math.sqrt";let data={operation:[],formula:[]};const calculatorButtons=[{name:"percent",symbol:"%",formula:"/100",type:"number"},{name:"clear",symbol:"C",formula:!1,type:"key"},{name:"delete",symbol:"DEL",formula:!1,type:"key"},{name:"power",symbol:"x^",formula:power,type:"math-function"},{name:"square-root",symbol:"&radic;",formula:sqrt,type:"math-function"},{name:"1 divised by",symbol:"1/x",formula:"1/x",type:"math-function"},{name:"square",symbol:"x&#178;",formula:power,type:"math-function"},{name:"division",symbol:"&#247;",formula:"/",type:"operator"},{name:"7",symbol:7,formula:7,type:"number"},{name:"8",symbol:8,formula:8,type:"number"},{name:"9",symbol:9,formula:9,type:"number"},{name:"multiply",symbol:"&#215;",formula:"*",type:"operator"},{name:"4",symbol:4,formula:4,type:"number"},{name:"5",symbol:5,formula:5,type:"number"},{name:"6",symbol:6,formula:6,type:"number"},{name:"minus",symbol:"-",formula:"-",type:"operator"},{name:"1",symbol:1,formula:1,type:"number"},{name:"2",symbol:2,formula:2,type:"number"},{name:"3",symbol:3,formula:3,type:"number"},{name:"plus",symbol:"+",formula:"+",type:"operator"},{name:"plus/minus",symbol:"&#177;",formula:-1,type:"operator"},{name:"0",symbol:0,formula:0,type:"number"},{name:"dot",symbol:".",formula:".",type:"number"},{name:"calculate",symbol:"=",formula:"=",type:"calculate"}];function calculator(button){if("number"===button.type)data.operation.push(button.symbol),data.formula.push(button.formula);else if("operator"===button.type)data.operation.push(button.symbol),data.formula.push(button.formula),"plus/minus"===button.name&&(data.operation.pop(),data.formula.pop(),"-"==data.operation[0]?data.operation.shift():data.operation.unshift("-"),data.formula.push("*"),data.formula.push(button.formula));else if("math-function"===button.type){let t,a;"power"===button.name?(t="^(",a=button.formula,data.operation.push(t),data.formula.push(a)):"square"===button.name?(t="^(",a=button.formula,data.operation.push(t),data.formula.push(a),data.operation.push("2)"),data.formula.push("2)")):(t=button.symbol+"(",a=button.formula+"(",data.operation.push(t),data.formula.push(a))}else if("calculate"===button.type){formulaStr=data.formula.join("");let powerSearchResult=search(data.formula,power),sqrtSearchResult=search(data.formula,sqrt);const bases=powerBaseGetter(data.formula,powerSearchResult),basesSqr=sqrtBaseGetter(data.formula,sqrtSearchResult);bases.forEach(t=>{let a=t+power,e="Math.pow("+t+",";formulaStr=formulaStr.replace(a,e),formulaStr.includes("Math.pow")&&")"!==formulaStr.split("")[formulaStr.length-1]&&(formulaStr+=")")}),basesSqr.forEach(t=>{let a=t+sqrt,e="Math.sqrt("+t+")";formulaStr=formulaStr.replace(a,e)});let result=0;result=eval(formulaStr)%1!=0?eval(formulaStr).toFixed(2):eval(formulaStr),data.operation=[],data.operation.push(result),data.formula=[],data.formula.push(result),updateOperationResult(result)}else"key"===button.type&&("delete"===button.name&&(data.formula.pop(),data.operation.pop()),"clear"===button.name&&(data.formula=[],data.operation=[],updateOperationResult(0)));updateOperationElement(data.operation.join(""))}function updateOperationElement(t){outputOperationElement.innerHTML=t}function updateOperationResult(t){outputResultElement.innerHTML=t}function renderCalculator(){let t=0;calculatorButtons.forEach(a=>{t%4==0&&(inputElement.innerHTML+='<div class="input__row"></div>'),document.querySelector(".input__row:last-child").innerHTML+=`<button id="${a.name}" class="btn">${a.symbol}</button>`,t++})}function powerBaseGetter(t,a){let e=[];return a.forEach(a=>{let o=[],r=0,u=a-1;for(;u>=0;){"("==t[u]&&r--,")"==t[u]&&r++;let a=!1;operators.forEach(e=>{t[u]==e&&(a=!0)});let e=t[u]==power;if(a&&0==r||e)break;o.unshift(t[u]),u--}e.push(o.join(""))}),e}function sqrtBaseGetter(t,a){let e=[];return a.forEach(a=>{let o=[],r=0,u=a-1;for(;u>=0;){"("==t[u]&&r--,")"==t[u]&&r++;let a=!1;operators.forEach(e=>{t[u]==e&&(a=!0)});let e=t[u]==sqrt;if(a&&0==r||e)break;o.unshift(t[u]),u--}e.push(o.join(""))}),e}function search(t,a){let e=[];return t.forEach((t,o)=>{a==t&&e.push(o)}),e}inputElement.addEventListener("click",t=>{calculatorButtons.forEach(a=>{a.name===t.target.id&&calculator(a)})}),renderCalculator();